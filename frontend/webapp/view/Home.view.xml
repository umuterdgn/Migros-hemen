<mvc:View
  controllerName="migros.controller.Home"
  xmlns:mvc="sap.ui.core.mvc"
  xmlns="sap.m"
  xmlns:core="sap.ui.core"
  xmlns:unified="sap.ui.unified"
  displayBlock="true">

  <Page title="Kategoriler">
    <HBox>
      <!-- Sidebar -->
      <VBox width="20%" class="sapUiSmallMarginEnd" style="margin-left:20px;" >
        <Button text="Ürün Ekle" press="onShowAddProduct" width="100%" />
        <Button text="Ürünler" press="onShowProductList" width="100%" class="sapUiTinyMarginTop"/>
      </VBox>

      <!-- Dinamik içerik alanı -->
      <VBox id="contentContainer" width="100%">
        <!-- Ürün Ekleme Paneli -->
        <Panel id="addProductPanel" headerText="Ürün Ekle" class="sapUiResponsiveMargin">
          <VBox class="sapUiSmallMargin">

            <Select
              items="{/categories}"
              selectedKey="{/newProduct/kategori_id}"
              change="onCategoryChange"
              width="200px">
              <core:Item key="{id}" text="{ad}" />
            </Select>

            <Select
              items="{/subcategories}"
              selectedKey="{/newProduct/subcategory_id}"
              change="onSubCategoryChange"
              width="200px">
              <core:Item key="{id}" text="{ad}" />
            </Select>
              <Select
                items="{/brands}"
                selectedKey="{/newProduct/brand_id}"
                change="onBrandChange"
                width="200px"
                placeholder="Marka Seç">
                <core:Item key="{id}" text="{name}" />
                </Select>

<!-- İndirim kapsamı: ürün bazlı mı, yoksa marka mı? -->
<Select selectedKey="{/newProduct/discount_scope}" width="200px">
  <core:Item key="product" text="Ürün Bazlı" />
  <core:Item key="brand"   text="Marka Bazlı" />
</Select>

<!-- Mevcut indirim tipi ve değeri -->
<Select selectedKey="{/newProduct/discount_type}" width="200px">
  <core:Item key="none"      text="Yok" />
  <core:Item key="percent"   text="Yüzde İndirimi" />
  <core:Item key="amount"    text="Tutar İndirimi" />
</Select>
<Input
  placeholder="İndirim Değeri"
  type="Number"
  value="{/newProduct/discount_value}"
  width="200px" />

            <Input placeholder="Ürün Adı" value="{/newProduct/ad}" width="300px" />
            <Input placeholder="Fiyat" type="Number" value="{/newProduct/price}" width="300px" />
            <Input placeholder="Stok" type="Number" value="{/newProduct/stock}" width="300px" />
            <!-- İndirim Tipi -->
            <!-- <Select selectedKey="{/newProduct/discount_type}" width="300px">
            <core:Item key="none" text="Yok" />
            <core:Item key="percent" text="Yüzde İndirim" />
            <core:Item key="amount" text="Tutar İndirimi" />
            </Select> -->

            <!-- <Input placeholder="İndirim Değeri" type="Number" value="{/newProduct/discount_value}" width="300px" /> -->

<CheckBox
  selected="{ path: '/newProduct/hasLimit', mode: 'TwoWay' }"
  select="onLimitToggle"
  class="sapUiSmallMarginTop"
  text="Alım Limiti var mı?"/>
<!-- StepInput görünürlüğü yine aynı binding ile -->
<StepInput
  value="{/newProduct/limitQty}"
  min="1"
  max="100"
  visible="{= ${/newProduct/hasLimit} }"
  width="100px"
  class="sapUiSmallMarginTop"/>
<unified:FileUploader
  id="fileUploader"
  change="onFileSelect"
  fileType="jpg,png"
  width="300px"
  class="sapUiSmallMarginTop"/>
<Image
  id="previewImage"
  visible="{= !!${/newProduct/image_url}}"
  src="{/newProduct/image_url}"
  width="200px"
  class="sapUiSmallMarginTop"
/>

          
            <!-- görsel ekleme -->
            <!-- <unified:FileUploader
              id="fileUploaderUpd" change="uploadFileForProduct"
              uploadUrl="" uploadComplete="onFileUploadComplete"/>
            <Image id="previewImage" visible="false" width="200px" height="auto" /> -->

            <Button text="Ürün Ekle" press="onUrunEkle" type="Emphasized" />
          </VBox>
        </Panel>

        <!-- Ürün Listesi -->
        <Panel id="productListPanel" headerText="Ürünler" class="sapUiResponsiveMargin" visible="false" style="margin-right:50px;"> 
  <VBox class="sapUiSmallMargin">
    <SearchField placeholder="Ara..." search="onSearchProduct" width="300px" />
    <Select change="onSortProduct" width="300px">
      <core:Item key="name" text="Ada göre sırala" />
      <core:Item key="price" text="Fiyata göre sırala" />
      <core:Item key="stock" text="Stoka göre sırala" />
    </Select>

    <!-- Ürün Listesi -->
    <ScrollContainer vertical="true" horizontal="false" height="400px" width="100%">
          <List id="productList" items="{/productList}" growing="true" growingScrollToLoad="false">
      <CustomListItem>
        <HBox justifyContent="SpaceBetween" alignItems="Center" class="sapUiSmallMargin" >
         <VBox>
      <Text text="{name}" class="sapUiTinyMarginBottom"/>

      <!-- Sadece indirimi varsa eski fiyatı göster -->
      <Text
        text="{price} ₺"
        wrapping="false"
        visible="{= ${discount_type} !== 'none' }"
        class="sapUiTinyMarginBottom lineThroughText" />

      <!-- İndirimli fiyat (veya orijinal fiyat, type=none ise eşit olur) -->
      <Text
        text="{effectivePrice} ₺"
        wrapping="false"
        class="sapUiTinyMarginBottom"
        design="Bold" />
    </VBox>
          <HBox>
            <Button text="Güncelle" press="onEditProduct" data-product="{.}" class="sapUiTinyMarginEnd" />
            <Button text="Sil" press="onDeleteProduct" type="Reject" />
          </HBox>
        </HBox>
      </CustomListItem>
    </List>
     </ScrollContainer>
  </VBox>
</Panel>

<!-- Güncelleme Popup -->
<!-- Güncelleme Popup -->
    <Dialog id="editDialog" title="Ürün Güncelle" draggable="true" resizable="true">
      <VBox class="sapUiSmallMargin">
        <Label text="Kategori" />
        <Select
          items="{/categories}"
          selectedKey="{/editProduct/category}"
          change="onDialogCategoryChange">
          <core:Item key="{id}" text="{ad}" />
        </Select>

        <Label text="Alt Kategori" />
        <Select items="{/filteredSubCategories}" selectedKey="{/editProduct/subcategory_id}">
          <core:Item key="{id}" text="{ad}" />
        </Select>

        <Text text="Marka" class="sapUiSmallMarginTop" />

<!-- AFTER -->
<!-- EDIT DIALOG içinde -->
<Select
  id="brandSelect" 
  items="{/brands}"
  selectedKey="{/editProduct/brand_id}"
  change="onBrandChange"         
  width="200px"
  placeholder="Marka Seç">
  <core:Item key="{id}" text="{name}" />
</Select>

          <Label text="Ürün Adı" />
          <Input value="{/editProduct/name}" />

        <Label text="Fiyat" />
        <Input type="Number" value="{/editProduct/price}" />

        <Label text="Stok" />
        <Input type="Number" value="{/editProduct/stock}" />

       <Label text="İndirim Tipi" />
<Label text="İndirim Tipi" />
<Select
  id="editDiscountType"
  selectedKey="{/editProduct/discount_type}"
  change="onDialogDiscountTypeChange"
  width="200px">
  <core:Item key="none"    text="Yok" />
  <core:Item key="percent" text="Yüzde İndirimi" />
  <core:Item key="amount"  text="Tutar İndirimi" />
</Select>

<Label text="İndirim Değeri" class="sapUiSmallMarginTop" />
<Input
  id="editDiscountValue"
  type="Number"
  liveChange="onDialogDiscountValueChange"
  value="{/editProduct/discount_value}"
  width="200px"
  placeholder="0" />
 
<CheckBox
  selected="{/editProduct/hasLimit}"
  select="onLimitToggleForEdit"
  text="Alım Limiti Var mı?"
  class="sapUiSmallMarginTop"/>
<StepInput
  value="{/editProduct/limitQty}"
  min="1"
  max="100"
  visible="{= ${/editProduct/hasLimit} }"
  width="100px"
  class="sapUiSmallMarginTop"/>

<!-- <unified:FileUploader
  id="editFileUploader"
  change="onEditFileChange"
  fileType="jpg,png"
  width="300px"
  class="sapUiSmallMarginTop"/>
<Image
  id="editPreviewImage"
  visible="{= !!${/editProduct/image_url}}"
  src="{/editProduct/image_url}"
  width="200px"
  class="sapUiSmallMarginTop"/> -->



        <Label text="Görsel (Base64)" />
        <unified:FileUploader change="onEditFileChange" fileType="jpg,png" />
        <Image src="{/editProduct/image_url}" width="150px" visible="{= !!${/editProduct/image_url}}" />
      </VBox>
       <beginButton>
    <Button
      text="Kaydet"
      type="Emphasized"
      press="onSaveEditedProduct" />
  </beginButton>

  <!-- Kapat butonu, sağdaki -->
  <endButton>
    <Button
      text="Kapat"
      press="onDialogClose" />
  </endButton>
    </Dialog>
      </VBox>
    </HBox>

    <!-- Kategoriler alanı -->
    <HBox justifyContent="Center">
      <VBox width="100%" alignItems="Center">
        <HBox
          id="categoryContainer"
          wrap="Wrap"
          justifyContent="Center"
          alignItems="Center"
          width="calc(100% - 100px)"
          style="margin-left:50px; margin-right:50px">
        </HBox>
      </VBox>
    </HBox>
  </Page>
</mvc:View>